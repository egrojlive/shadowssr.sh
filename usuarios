#!/bin/bash
drp=( `ps aux | grep -i dropbear | awk '{print $2}' | wc -w | grep -v root`);
sh=( `sudo ps aux | grep sshd | cut -d " " -f 1 | grep -v sshd | grep -v root | wc -w`);
data=( `ps aux | grep -i dropbear | awk '{print $2}'`);
#echo 'USUARIOS LOGUEADOS EN EL SISTEMA   ' $((todos))
echo 'USUARIOS LOGUEADOS DROPBEAR   ' $((drp -2))
echo 'usuarios  -  conexiones'
for PID in "${data[@]}"
do
        NUM1=`cat /var/log/auth.log | grep -i dropbear | grep -i "Password auth succeeded" | grep "dropbear\[$PID\]" | wc -l`;
        USER=`cat /var/log/auth.log | grep -i dropbear | grep -i "Password auth succeeded" | grep "dropbear\[$PID\]" | awk '{print $10}'`;
        IP=`cat /var/log/auth.log | grep -i dropbear | grep -i "Password auth succeeded" | grep "dropbear\[$PID\]" | awk '{print $12}'`;
        if [ $NUM1 -eq 1 ]; then
                echo $USER ':' $NUM1;
        fi
done
echo 'USUARIOS CONECTADOS EN SSH ' $((sh))
#listassh=( `ps aux | grep sshd | cut -d " " -f 1 | grep -v sshd | grep -v root`);
#listageneral=( ``);
ps aux | grep sshd | cut -d " " -f 1 | grep -v sshd | grep -v root
echo 'USUARIOS DEL SISTEMA :'
grep /home/ /etc/passwd | grep -v syslog | grep -v root | cut -d ":" -f1,5 | grep -v ntp | grep -v debian
echo '=============================================='
echo '-------------CODEERROR-----------'
echo '=============================================='
